(function($){$('.consignment-status-list').on('change',function(event){event.preventDefault();var consignmentID=$(this).data('consignmentid');var optionID=$(this).val();var currentStatus=$("#current_consignment_status_"+consignmentID).val();change_consignemnt_status_fun(consignmentID,optionID,currentStatus);function change_consignemnt_status_fun(shipmentID,optionID,currentStatus){if(currentStatus!=optionID&&optionID!=''){$('#update_consignment_status_'+shipmentID).attr('disabled',!1)}else{$('#update_consignment_status_'+shipmentID).attr('disabled',!0)}}});$(document).on('click','.update_consignment_status',function(){var consignmentid=$(this).data('updateconsignment');var optionID=$("#consignment-status-list-"+consignmentid).val();var current_long=$("#current_long").val();var current_lat=$("#current_lat").val();var email_send=$("#email_send_toggler").prop('checked');var reason=$("#rej-desc").val();var send_mail="0";if(email_send){send_mail="1"}
update_consignment_status(consignmentid,optionID,reason,current_lat,current_long,send_mail)});$('.shipment-status-list').on('change',function(event){event.preventDefault();var shipmentID=$(this).data('shipmentid');var optionID=$(this).val();var currentStatus=$("#currentStatus-"+shipmentID).val();change_shipment_status_fun(shipmentID,optionID,currentStatus);function change_shipment_status_fun(shipmentID,optionID,currentStatus){if(currentStatus!=optionID&&optionID!=''){$('#update_shipment_status_'+shipmentID).attr('disabled',!1)}else{$('#update_shipment_status_'+shipmentID).attr('disabled',!0)}}});$(document).on('click','.update_shipment_status',function(){event.preventDefault();var shipmentID=$(this).data('updateshipment');var statusID=$("#shipment-status-list"+shipmentID).val();var current_lat=$("#current_lat").val();var current_long=$("#current_long").val();var email_send=$("#email_send_toggler").prop('checked');var reason=$("#rejectReasonDesc").val();var send_mail="0";if(email_send){send_mail="1"}
update_shipment_status_fun(shipmentID,statusID,reason,current_lat,current_long,send_mail)});$(".rider_ship_action").on("click",function(e){e.preventDefault();var ship_id=$(this).attr('data-ship_id');current_lat=$(this).attr('data-current_lat');current_long=$(this).attr('data-current_long');$.post(anvoy_framework_public_ajax.ajax_url,{action:'rider_shipment_status_action','ship_id':ship_id,'current_lat':current_lat,'current_long':current_long,}).done(function(response){$('.cp-loader').hide();if($.trim(response)=='2'){toastr.error($('#not_log_in').val(),'',{timeOut:2500,"closeButton":!0,"positionClass":"toast-top-right"})}else{$("#status_action_data").html(response);$(function(){$('#email_send_toggler').bootstrapToggle()});$(".js-example-basic-single").select2({allowClear:!0,maximumSelectionLength:5,language:{noResults:function(params){return get_strings.no_res}}});$("#myModalaction").modal("show");var mymap=L.map('shipment_update_location_map').setView([current_lat,current_long],10);L.tileLayer('https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}{r}.png',{maxZoom:18,attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, '+'<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, '+'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',id:'mapbox.streets'}).addTo(mymap);var srcMarker=L.marker([current_lat,current_long],{draggable:!0}).addTo(mymap);var searchControl=new L.Control.Search({url:'//nominatim.openstreetmap.org/search?format=json&q={s}',jsonpParam:'json_callback',propertyName:'display_name',propertyLoc:['lat','lon'],marker:srcMarker,autoCollapse:!0,autoType:!0,minLength:2,});searchControl.on('search:locationfound',function(obj){var lt=obj.latlng+'';var res=lt.split("LatLng(");res=res[1].split(")");res=res[0].split(",");document.getElementById('current_lat').value=res[0];document.getElementById('current_long').value=res[1]});mymap.addControl(searchControl);srcMarker.on('dragend',function(e){document.getElementById('current_lat').value=srcMarker.getLatLng().lat;document.getElementById('current_long').value=srcMarker.getLatLng().lng});$('#myModalaction').on('shown.bs.modal',(e)=>{mymap.invalidateSize()})}})});$(".driver_ship_action").on("click",function(e){e.preventDefault();var ship_id=$(this).attr('data-ship_id');current_lat=$(this).attr('data-current_lat');current_long=$(this).attr('data-current_long');$.post(anvoy_framework_public_ajax.ajax_url,{action:'driver_shipment_status_action','ship_id':ship_id,'current_lat':current_lat,'current_long':current_long,}).done(function(response){$('.cp-loader').hide();if($.trim(response)=='2'){toastr.error($('#not_log_in').val(),'',{timeOut:2500,"closeButton":!0,"positionClass":"toast-top-right"})}else{$("#status_action_data").html(response);$(function(){$('#email_send_toggler').bootstrapToggle()});$(".js-example-basic-single").select2({allowClear:!0,maximumSelectionLength:5,language:{noResults:function(params){return get_strings.no_res}}});$("#myModalaction").modal("show");var mymap=L.map('shipment_update_location_map').setView([current_lat,current_long],10);L.tileLayer('https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}{r}.png',{maxZoom:18,attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, '+'<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, '+'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',id:'mapbox.streets'}).addTo(mymap);var srcMarker=L.marker([current_lat,current_long],{draggable:!0}).addTo(mymap);var searchControl=new L.Control.Search({url:'//nominatim.openstreetmap.org/search?format=json&q={s}',jsonpParam:'json_callback',propertyName:'display_name',propertyLoc:['lat','lon'],marker:srcMarker,autoCollapse:!0,autoType:!0,minLength:2,});searchControl.on('search:locationfound',function(obj){var lt=obj.latlng+'';var res=lt.split("LatLng(");res=res[1].split(")");res=res[0].split(",");document.getElementById('current_lat').value=res[0];document.getElementById('current_long').value=res[1]});mymap.addControl(searchControl);srcMarker.on('dragend',function(e){document.getElementById('current_lat').value=srcMarker.getLatLng().lat;document.getElementById('current_long').value=srcMarker.getLatLng().lng});$('#myModalaction').on('shown.bs.modal',(e)=>{mymap.invalidateSize()})}})});$(document).on('click','.driver_ship_reject',function(e){e.preventDefault();var ship_id=$(this).attr('data-ship_id');current_lat=$(this).attr('data-current_lat');current_long=$(this).attr('data-current_long');is_reject="1";$.post(anvoy_framework_public_ajax.ajax_url,{action:'driver_shipment_status_action','ship_id':ship_id,'current_lat':current_lat,'current_long':current_long,'is_reject':is_reject,}).done(function(response){$('.cp-loader').hide();if($.trim(response)=='2'){toastr.error($('#not_log_in').val(),'',{timeOut:2500,"closeButton":!0,"positionClass":"toast-top-right"})}else{$("#status_action_data").html(response);$(function(){$('#email_send_toggler').bootstrapToggle()});$(".js-example-basic-single").select2({allowClear:!0,maximumSelectionLength:5,language:{noResults:function(params){return get_strings.no_res}}});$("#myModalaction").modal("show");var mymap=L.map('shipment_update_location_map').setView([current_lat,current_long],10);L.tileLayer('https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}{r}.png',{maxZoom:18,attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, '+'<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, '+'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',id:'mapbox.streets'}).addTo(mymap);var srcMarker=L.marker([current_lat,current_long],{draggable:!0}).addTo(mymap);var searchControl=new L.Control.Search({url:'//nominatim.openstreetmap.org/search?format=json&q={s}',jsonpParam:'json_callback',propertyName:'display_name',propertyLoc:['lat','lon'],marker:srcMarker,autoCollapse:!0,autoType:!0,minLength:2,});searchControl.on('search:locationfound',function(obj){var lt=obj.latlng+'';var res=lt.split("LatLng(");res=res[1].split(")");res=res[0].split(",");document.getElementById('current_lat').value=res[0];document.getElementById('current_long').value=res[1]});mymap.addControl(searchControl);srcMarker.on('dragend',function(e){document.getElementById('current_lat').value=srcMarker.getLatLng().lat;document.getElementById('current_long').value=srcMarker.getLatLng().lng});$('#myModalaction').on('shown.bs.modal',(e)=>{mymap.invalidateSize()})}})});$(document).on('click','.save-rejection-reason',function(){event.preventDefault();var shipmentID=$(this).data('saveshipment');statusID=-1;var reason=$("#rejectReasonDesc"+shipmentID).val();if(reason!=''){update_shipment_status_fun(shipmentID,statusID,reason,current_lat='',current_long='',email_send='')}else{$("#rejectReasonDesc"+shipmentID).val('please enter reason here')}});function update_shipment_status_fun(shipmentID,statusID,reason,current_lat='',current_long='',email_send=''){$.ajax({url:anvoy_framework_dashboard_ajax.ajax_url,type:'POST',data:{action:'shipment_chnage_status_frontend',shipmentID:shipmentID,statusID:statusID,rejectionReason:reason,current_lat:current_lat,current_long:current_long,email_send:email_send,}}).done(function(response){if(response==1){$.alert({title:'',icon:'fa fa-smile-o',theme:'modern',animation:'scale',type:'green',content:anvoy_framework_public_ajax.status_change,buttons:{okay:{btnClass:'btn-blue',action:function(){window.location.reload()},}}});$("#rejectedModal"+shipmentID).modal('hide')}else if($.trim(response)=="99"){toastr.error(anvoy_framework_public_ajax.demo_mode,'',{timeOut:2500,"closeButton":!0,"positionClass":"toast-top-right"})}}).fail(function(){console.log("error")}).always(function(){})}
$(document).on('click','.updating_status_rider',function(event){event.preventDefault();var shipmentID=$(this).data('riderstatus');var statusID=$('#rider_shipment_status').val();var current_lat=$("#current_lat").val();var current_long=$("#current_long").val();var email_send=$("#email_send_toggler").prop('checked');var send_mail="0";if(email_send){send_mail="1"}
if(statusID!==''&&statusID=='8'){$.ajax({url:anvoy_framework_dashboard_ajax.ajax_url,type:'POST',data:{action:'rider_status_change',shipmentID:shipmentID,statusID:statusID,reason:reason,current_lat:current_lat,current_long:current_long,email_send:send_mail,},}).done(function(response){if(response=='1'){$.alert({title:'',icon:'fa fa-smile-o',theme:'modern',animation:'scale',type:'green',content:'status changed',buttons:{okay:{btnClass:'btn-blue',action:function(){window.location.reload()},}}})}else if(response=="99"){toastr.error(anvoy_framework_public_ajax.demo_mode,'',{timeOut:2500,"closeButton":!0,"positionClass":"toast-top-right"})}})}
if(statusID!==''&&statusID=='9'){var reason=prompt('Enter Receiver Detail Here','');if(reason!=null||reason!=""){$.ajax({url:anvoy_framework_dashboard_ajax.ajax_url,type:'POST',data:{action:'rider_status_change',shipmentID:shipmentID,statusID:statusID,reason:reason,current_lat:current_lat,current_long:current_long,},}).done(function(response){if(response=='1'){$.alert({title:'',closeIcon:!0,icon:'fa fa-smile-o',theme:'modern',animation:'scale',type:'green',content:'status changed',buttons:{okay:{btnClass:'btn-blue',action:function(){window.location.reload()},}}})}else if(response=="99"){toastr.error(anvoy_framework_public_ajax.demo_mode,'',{timeOut:2500,"closeButton":!0,"positionClass":"toast-top-right"})}})}}});$(document).on('change','#check_all_ship',function(event){var state=!1;if(this.checked!=!0){state=!0}else{state=!1}
$('.singleShipCheck').each(function(){if(!state){this.checked=!0}else{this.checked=!1}})});$('#apply_shipment_statuses').on('click',function(){var consignmentid=$(this).data('applyconsignment');var topStatus=$('#select_shipment_top_status').val();var email_send=$('#send_bulk_email').val();if(topStatus==null){toastr.error(anvoy_framework_public_ajax.select_status,'',{timeOut:2500,"closeButton":!0,"positionClass":"toast-top-right"})}
var selected_shipments=[];$.each($("#allShipmentList input[name='shipmentSingle']:checked"),function(){selected_shipments.push($(this).val())});if(selected_shipments.length==0&&topStatus!=null){toastr.error(anvoy_framework_public_ajax.select_shipment,'',{timeOut:2500,"closeButton":!0,"positionClass":"toast-top-right"})};if(topStatus==-1&&selected_shipments.length>0){$("#rejectedModal"+consignmentid).modal('show');var btn=$("#rejectedModal"+consignmentid).find("#saveReasonDesc"+consignmentid).on('click',function(){var reason=$("#rejectedModal"+consignmentid).find("#rejectReasonDesc"+consignmentid).val();reason==''?$("#rejectedModal"+consignmentid).find("#rejectReasonDesc"+consignmentid).attr("placeholder","please enter reason here"):update_all_shipment_status(topStatus,selected_shipments,reason)})}
if(topStatus!=-1&&selected_shipments.length>0){update_all_shipment_status(topStatus,selected_shipments,reason='',email_send)}});function update_all_shipment_status(topStatus,selected_shipments,reason,email_send){$.ajax({url:anvoy_framework_dashboard_ajax.ajax_url,type:'POST',data:{action:'change_selected_shipment_status',selected_shipments:selected_shipments,statusID:topStatus,rejectionReason:reason,email_send:email_send,}}).done(function(response){$('#check_all_ship').prop("checked",!1);$.each($("#allShipmentList input[name='shipmentSingle']:checked"),function(){$(this).prop("checked",!1)});if(response=="99"){toastr.error(anvoy_framework_public_ajax.demo_mode,'',{timeOut:2500,"closeButton":!0,"positionClass":"toast-top-right"})}else{$.alert({title:'',closeIcon:!0,icon:'fa fa-smile-o',theme:'modern',animation:'scale',type:'green',content:anvoy_framework_public_ajax.status_change,buttons:{okay:{btnClass:'btn-blue',action:function(){window.location.reload()},}}})}}).fail(function(){console.log("error")}).always(function(){})}
function update_consignment_status(consignmentid,optionID,reason,current_lat,current_long,send_email){$.ajax({url:anvoy_framework_dashboard_ajax.ajax_url,type:'POST',data:{action:'consignment_chnage_status_frontend',consignmentid:consignmentid,optionID:optionID,rejectionReason:reason,current_lat:current_lat,current_long:current_long,send_email:send_email,}}).done(function(response){if(response==1){$('#rejectedModalCon'+consignmentid).modal("hide");$.alert({title:'',icon:'fa fa-smile-o',theme:'modern',animation:'scale',type:'green',content:'status changed',buttons:{okay:{btnClass:'btn-blue',action:function(){window.location.reload()},},},});$('#update_consignment_status_'+consignmentid).attr('disabled',!0)}else if($.trim(response)=="99"){toastr.error(anvoy_framework_public_ajax.demo_mode,'',{timeOut:2500,"closeButton":!0,"positionClass":"toast-top-right"})}}).fail(function(){console.log("error")}).always(function(){})}
$(document).on('click','.complete_shipment',function(event){event.preventDefault();var shipmentID=$(this).data('shipmentid');var currentphase=$("#currentphase-"+shipmentID).val();$.ajax({url:anvoy_framework_dashboard_ajax.ajax_url,type:'POST',data:{action:'complete_shipment_phase',shipmentID:shipmentID,currentphase:currentphase},}).done(function(response){if(response=='1'){$("#complete_shipment_status_"+shipmentID).attr({"disabled":'true',});$("#status_list_continer_"+shipmentID).html('completed');$("#complete_shipment_status_"+shipmentID).html('completed');$.alert({title:'',closeIcon:!0,icon:'fa fa-smile-o',theme:'modern',animation:'scale',type:'green',content:'succesfully deliverd',buttons:{okay:{btnClass:'btn-blue'}}})}else{$.alert({title:'',closeIcon:!0,icon:'fa fa-smile-o',theme:'modern',animation:'scale',type:'green',content:'something wrong',buttons:{okay:{btnClass:'btn-blue'}}})}}).fail(function(){console.log("error")}).always(function(){})});$(".driver_cons_action").on("click",function(event){event.preventDefault();var cons_id=$(this).attr('data-cons_id');current_lat=$(this).attr('data-current_lat');current_long=$(this).attr('data-current_long');$.post(anvoy_framework_public_ajax.ajax_url,{action:'driver_const_status_action','cons_id':cons_id,'current_lat':current_lat,current_long:current_long,}).done(function(response){if($.trim(response)=='2'){toastr.error($('#not_log_in').val(),'',{timeOut:2500,"closeButton":!0,"positionClass":"toast-top-right"})}else{$("#status_action_data").html(response);$(function(){$('#email_send_toggle').bootstrapToggle()});$(".js-example-basic-single").select2({allowClear:!0,maximumSelectionLength:5,language:{noResults:function(params){}}});$("#myModalaction2").modal("show");var mymap=L.map('consignment_update_location_map').setView([current_lat,current_long],10);L.tileLayer('https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}{r}.png',{maxZoom:18,attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, '+'<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, '+'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',id:'mapbox.streets'}).addTo(mymap);var srcMarker=L.marker([current_lat,current_long],{draggable:!0}).addTo(mymap);var searchControl=new L.Control.Search({url:'//nominatim.openstreetmap.org/search?format=json&q={s}',jsonpParam:'json_callback',propertyName:'display_name',propertyLoc:['lat','lon'],marker:srcMarker,autoCollapse:!0,autoType:!0,minLength:2,});searchControl.on('search:locationfound',function(obj){var lt=obj.latlng+'';var res=lt.split("LatLng(");res=res[1].split(")");res=res[0].split(",");document.getElementById('current_lat').value=res[0];document.getElementById('current_long').value=res[1]});mymap.addControl(searchControl);srcMarker.on('dragend',function(e){document.getElementById('current_lat').value=srcMarker.getLatLng().lat;document.getElementById('current_long').value=srcMarker.getLatLng().lng});$('#myModalaction2').on('shown.bs.modal',(e)=>{mymap.invalidateSize()})}})});$(".driver_con_reject").on("click",function(event){event.preventDefault();var cons_id=$(this).attr('data-cons_id');current_lat=$(this).attr('data-current_lat');current_long=$(this).attr('data-current_long');var is_reject="1";$.post(anvoy_framework_public_ajax.ajax_url,{action:'driver_const_status_action','cons_id':cons_id,'is_reject':is_reject,'current_lat':current_lat,current_long:current_long,}).done(function(response){if($.trim(response)=='2'){toastr.error($('#not_log_in').val(),'',{timeOut:2500,"closeButton":!0,"positionClass":"toast-top-right"})}else{$("#status_action_data").html(response);$(function(){$('#email_send_toggle').bootstrapToggle()});$(".js-example-basic-single").select2({allowClear:!0,maximumSelectionLength:5,language:{noResults:function(params){}}});$("#myModalaction2").modal("show");var mymap=L.map('consignment_update_location_map').setView([current_lat,current_long],10);L.tileLayer('https://cartodb-basemaps-{s}.global.ssl.fastly.net/light_all/{z}/{x}/{y}{r}.png',{maxZoom:18,attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, '+'<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, '+'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',id:'mapbox.streets'}).addTo(mymap);var srcMarker=L.marker([current_lat,current_long],{draggable:!0}).addTo(mymap);var searchControl=new L.Control.Search({url:'//nominatim.openstreetmap.org/search?format=json&q={s}',jsonpParam:'json_callback',propertyName:'display_name',propertyLoc:['lat','lon'],marker:srcMarker,autoCollapse:!0,autoType:!0,minLength:2,});searchControl.on('search:locationfound',function(obj){var lt=obj.latlng+'';var res=lt.split("LatLng(");res=res[1].split(")");res=res[0].split(",");document.getElementById('current_lat').value=res[0];document.getElementById('current_long').value=res[1]});mymap.addControl(searchControl);srcMarker.on('dragend',function(e){document.getElementById('current_lat').value=srcMarker.getLatLng().lat;document.getElementById('current_long').value=srcMarker.getLatLng().lng});$('#myModalaction2').on('shown.bs.modal',(e)=>{mymap.invalidateSize()})}})});$(document).on('click','.update_consignment_status_reject',function(){var consignmentid=$(this).data('updateconsignment');var reason=$.trim($("#rej-desc").val());var current_lat=$("#current_lat").val();var current_long=$("#current_long").val();var email_send=$("#email_send_toggler").prop('checked');var reason=$("#rejectReasonDesc").val();var send_mail="0";if(email_send){send_mail="1"}
if(!reason){$("#myModalactionreject").find("#rej-desc").attr("placeholder","please enter reason here")}else{update_consignment_status(consignmentid,-1,reason)}})})(jQuery)
;